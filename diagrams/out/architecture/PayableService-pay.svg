<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="441px" preserveAspectRatio="none" style="width:1877px;height:441px;background:#FFFFFF;" version="1.1" viewBox="0 0 1877 441" width="1877px" zoomAndPan="magnify"><defs><filter height="300%" id="f1fwgj1uy89gac" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1fwgj1uy89gac)" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="470" x="10" y="232.0938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="48" x2="48" y1="40.2969" y2="397.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="406" x2="406" y1="40.2969" y2="397.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="731" x2="731" y1="40.2969" y2="397.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="922" x2="922" y1="40.2969" y2="397.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1120" x2="1120" y1="40.2969" y2="397.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1321" x2="1321" y1="40.2969" y2="397.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1496" x2="1496" y1="40.2969" y2="397.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1641" x2="1641" y1="40.2969" y2="397.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1793" x2="1793" y1="40.2969" y2="397.8906"/><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="52" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="27" y="24.9951">Caller</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="52" x="20" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="27" y="416.8857">Caller</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="124" x="342" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="349" y="24.9951">PaymentService</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="124" x="342" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="349" y="416.8857">PaymentService</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="164" x="647" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="654" y="24.9951">PaymentMethodRepo</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="164" x="647" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="654" y="416.8857">PaymentMethodRepo</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="190" x="825" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="832" y="24.9951">GatewayConnectionRepo</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="190" x="825" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="832" y="416.8857">GatewayConnectionRepo</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="179" x="1029" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="1036" y="24.9951">PayableWorkflowFactory</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="179" x="1029" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="1036" y="416.8857">PayableWorkflowFactory</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="194" x="1222" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180" x="1229" y="24.9951">PaymentProcessorFactory</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="194" x="1222" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180" x="1229" y="416.8857">PaymentProcessorFactory</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="129" x="1430" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="1437" y="24.9951">PayableWorkflow</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="129" x="1430" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="1437" y="416.8857">PayableWorkflow</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="132" x="1573" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="1580" y="24.9951">TransactionRepo</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="132" x="1573" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="1580" y="416.8857">TransactionRepo</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="144" x="1719" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="1726" y="24.9951">PaymentProcessor</text><rect fill="#FEFECE" filter="url(#f1fwgj1uy89gac)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="144" x="1719" y="396.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="1726" y="416.8857">PaymentProcessor</text><polygon fill="#A80036" points="394,67.4297,404,71.4297,394,75.4297,398,71.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="48" x2="400" y1="71.4297" y2="71.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="55" y="66.3638">pay(payment_params: PaymentParams, user: User)</text><polygon fill="#A80036" points="719,96.5625,729,100.5625,719,104.5625,723,100.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="406" x2="725" y1="100.5625" y2="100.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="413" y="95.4966">get_payment_method(payment_params, user)</text><polygon fill="#A80036" points="910,125.6953,920,129.6953,910,133.6953,914,129.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="406" x2="916" y1="129.6953" y2="129.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="428" x="413" y="124.6294">get_active_gateway_connection(payment_method.gateway_name)</text><polygon fill="#A80036" points="1108.5,154.8281,1118.5,158.8281,1108.5,162.8281,1112.5,158.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="406" x2="1114.5" y1="158.8281" y2="158.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="413" y="153.7622">get_payable_workflow(payment_params)</text><polygon fill="#A80036" points="1309,183.9609,1319,187.9609,1309,191.9609,1313,187.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="406" x2="1315" y1="187.9609" y2="187.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="413" y="182.895">get_payment_processor(payment_method)</text><polygon fill="#A80036" points="1484.5,213.0938,1494.5,217.0938,1484.5,221.0938,1488.5,217.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="406" x2="1490.5" y1="217.0938" y2="217.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="413" y="212.0278">check_if_accepting_payment()</text><path d="M10,232.0938 L74,232.0938 L74,239.0938 L64,249.0938 L10,249.0938 L10,232.0938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="470" x="10" y="232.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="245.1606">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="321" x="89" y="244.3042">[check_if_accepting_payment throws BadRequest]</text><polygon fill="#A80036" points="59,266.3594,49,270.3594,59,274.3594,55,270.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53" x2="405" y1="270.3594" y2="270.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="65" y="265.2935">raise BadRequest</text><polygon fill="#A80036" points="1629,302.4922,1639,306.4922,1629,310.4922,1633,306.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="406" x2="1635" y1="306.4922" y2="306.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="642" x="413" y="301.4263">transaction = get_or_create_transaction(payment_params, payment_method, gateway_connection)</text><polygon fill="#A80036" points="1781,346.7578,1791,350.7578,1781,354.7578,1785,350.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="406" x2="1787" y1="350.7578" y2="350.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="629" x="413" y="330.5591">payment_result = payment_processor(payment_params, payment_method, gateway_connection)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="434" x="413" y="345.6919">These inputs may be combined into a single "PaymentContext" type</text><polygon fill="#A80036" points="1484.5,375.8906,1494.5,379.8906,1484.5,383.8906,1488.5,379.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="406" x2="1490.5" y1="379.8906" y2="379.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="413" y="374.8247">apply_payment_result(payment_result)</text><!--MD5=[e75bc6207d9eb46e0a5e7dc9eb1d25e1]
@startuml
Caller -> PaymentService : pay(payment_params: PaymentParams, user: User)
PaymentService -> PaymentMethodRepo : get_payment_method(payment_params, user)
PaymentService -> GatewayConnectionRepo : get_active_gateway_connection(payment_method.gateway_name)
PaymentService -> PayableWorkflowFactory : get_payable_workflow(payment_params)
PaymentService -> PaymentProcessorFactory : get_payment_processor(payment_method)
PaymentService -> PayableWorkflow : check_if_accepting_payment()
alt check_if_accepting_payment throws BadRequest
    PaymentService -> Caller : raise BadRequest
end
PaymentService -> TransactionRepo : transaction = get_or_create_transaction(payment_params, payment_method, gateway_connection)
PaymentService -> PaymentProcessor : payment_result = payment_processor(payment_params, payment_method, gateway_connection)\nThese inputs may be combined into a single "PaymentContext" type
PaymentService -> PayableWorkflow : apply_payment_result(payment_result)
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>